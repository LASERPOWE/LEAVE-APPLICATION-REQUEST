<!DOCTYPE html>
<html>
<head>
  <title>Leave Application Form</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f1f1f1;
      padding: 20px;
    }
    .form-container {
      background: white;
      padding: 20px;
      max-width: 500px;
      margin: auto;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input, select, textarea {
      width: 100%;
      padding: 8px;
      margin: 8px 0;
    }
    input[readonly] {
      background: #f5f5f5;
    }
    button {
      padding: 10px;
      background: green;
      color: white;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div class="form-container">
  <h2>Leave Application Form</h2>

  <label>EMP_CODE</label>
  <input type="text" id="empCodeInput" placeholder="Enter Emp Code">

  <button onclick="loadData()">Fetch Details</button>

  <form id="leaveForm">
    <label>EMP_NAME</label>
    <input type="text" id="empName" readonly>

    <label>DESIG_NAME</label>
    <input type="text" id="desigName" readonly>

    <label>DEPT_NAME</label>
    <input type="text" id="deptName" readonly>

    <label>HOD</label>
    <input type="text" id="hod" readonly>

    <label>HOD MAIL</label>
    <input type="text" id="hodMail" readonly>

    <label>LEAVE TYPE</label>
    <select id="leaveType">
      <option value="CL">CL</option>
      <option value="SL">SL</option>
      <option value="COFF">COFF</option>
    </select>

    <label>FROM DATE</label>
    <input type="date" id="fromDate">

    <label>TO DATE</label>
    <input type="date" id="toDate">

    <label>REASON</label>
    <textarea id="reason"></textarea>

    <label>TAKEN LEAVE COUNT</label>
    <input type="text" id="leaveCount">

    <label>USER MAIL</label>
    <input type="email" id="userMail">

    <button type="submit">Submit</button>
  </form>
</div>

<script>
  const GET_URL = "https://script.google.com/macros/s/AKfycby4fCr8tZTN63ypNxGUeparjkR8BhAYwNRde_LaZ-7XafTPKABGWagdEza8YoPOrrWuUA/exec";
  const POST_URL = GET_URL;

  async function loadData() {
    const empCode = document.getElementById("empCodeInput").value;
    if (!empCode) {
      alert("Enter EMP_CODE");
      return;
    }

    const url = `${GET_URL}?emp_code=${empCode}`;
    const response = await fetch(url);
    const data = await response.json();

    if (data && data.success) {
      const d = data.data;
      document.getElementById("empName").value = d.EMP_NAME || "";
      document.getElementById("desigName").value = d.DESIG_NAME || "";
      document.getElementById("deptName").value = d.DEPT_NAME || "";
      document.getElementById("hod").value = d.HOD || "";
      document.getElementById("hodMail").value = d.HOD_MAIL || "";
    } else {
      alert("Employee not found");
    }
  }

  document.getElementById("leaveForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const payload = {
      EMP_CODE: document.getElementById("empCodeInput").value,
      EMP_NAME: document.getElementById("empName").value,
      DESIG_NAME: document.getElementById("desigName").value,
      DEPT_NAME: document.getElementById("deptName").value,
      HOD: document.getElementById("hod").value,
      HOD_MAIL: document.getElementById("hodMail").value,
      LEAVE_TYPE: document.getElementById("leaveType").value,
      FROM_DATE: document.getElementById("fromDate").value,
      TO_DATE: document.getElementById("toDate").value,
      REASON: document.getElementById("reason").value,
      TAKEN_LEAVE_COUNT: document.getElementById("leaveCount").value,
      USER_MAIL: document.getElementById("userMail").value
    };

    const res = await fetch(POST_URL, {
      method: "POST",
      body: JSON.stringify(payload),
      headers: {
        "Content-Type": "application/json"
      }
    });

    const result = await res.json();
    alert(result.message || "Submitted successfully!");
  });
</script>

</body>
</html>
